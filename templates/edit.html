{% extends 'base.html' %}

{% block scripts %}
<script>
  function toTitleCase(str) {
    return str.replace(
      /\w\S*/g,
      function (txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
      }
    );
  }

  $(function () {

    $('#auto-format').click(function (e) {
      //lowercase everything first to make the regex less of a nightmare
      var new_name = $('#new_file_name').val().toLowerCase();

      // remove karaoke references
      new_name = new_name.replace(/\(\s?karaoke.*\)/g, "");
      new_name = new_name.replace(/\[\s?karaoke.*\]/g, "");
      new_name = new_name.replace(/karaoke.(version|video|instrumental)/g, "");
      new_name = new_name.replace("[ goodkaraokesongs.com ]", "");
      new_name = new_name.replace(/karaoke/g, "");
      new_name = new_name.replace("karafun", "");

      //one-offs
      new_name = new_name.replace(/.no guide melody./g, "");
      new_name = new_name.replace(/\(hd[ ].*\)/g, "");
      new_name = new_name.replace("as popularized by", "-");
      new_name = new_name.replace("in the style of", "-");
      new_name = new_name.replace("instrumental", "");
      new_name = new_name.replace(/\(?no lead vocal\)?/g, "");
      new_name = new_name.replace(/with.lyrics/g, "");
      new_name = new_name.replace(/\(lyrics.*\)/g, "");
      new_name = new_name.replace(/\[lyrics.*\]/g, "");
      new_name = new_name.replace("(cc)", "");

      //fix symbols
      new_name = new_name.replace(/|/g, "");
      new_name = new_name.replace(/_/g, "");
      new_name = new_name.replace("- -", "-");
      new_name = new_name.replace("--", "-");
      new_name = new_name.replace("&Amp;", "&")

      //fix up whitespace duplicates
      new_name = new_name.replace(/\s\s+/g, " ");
      new_name = new_name.trim();

      //title case
      new_name = toTitleCase(new_name);

      $('#new_file_name').val(new_name);
    });

    $('#swap-order').click(function (e) {
      var split_name = $('#new_file_name').val().split(' - ');
      var new_name = split_name[1] + " - " + split_name[0];
      new_name = new_name.trim();
      $('#new_file_name').val(new_name);
    });
    $('.confirm-delete').click(function (e) {
      e.preventDefault();
      if (window.confirm("Are you sure you want to delete this song from the library?")) {
        location.href = this.href;
      }
    });

  });
</script>
{% endblock %}

{% block header %}
<h1>{% block title %}Edit Song{% endblock %}</h1>
{% endblock %}

{% block content %}


<div class="field">
  <form action="{{ url_for('edit_file') }}" method="post">
    <div class="field">
      <p class='has-text-warning'>{{ filename_from_path(song.decode('utf-8')) }} </p>
    </div>
    <input value="{{ song.decode('utf-8') }}" type="hidden" name='old_file_name'>
    <label class="label">Edit Song Name</label>
    <div class="field">
      <input autocomplete="off" id="new_file_name" class="input" type="text" name='new_file_name'
        value='{{ filename_from_path(song.decode('utf-8')) }}'></input>
    </div>
    <ul>
      <li><a id='auto-format'>Auto-format</a></li>
      <li><a id='swap-order'>Swap artist/song order</a></li>
    </ul>
    <div class="field">
      <button class="button is-primary" id="search-button" type="submit">Save</button>
    </div>
  </form>
</div>

<hr>
<a class="edit-button confirm-delete has-text-danger is-pulled-right"
  href="{{url_for('delete_file')}}?song={{url_escape(song)}}">Delete this song</a><br>



{% endblock %}